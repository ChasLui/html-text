"use strict";/*!
 * @pixi/text-html - v3.2.0
 * Compiled Thu, 22 Dec 2022 02:14:53 UTC
 *
 * @pixi/text-html is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Object.defineProperty(exports,"__esModule",{value:!0});var w=require("@pixi/sprite"),h=require("@pixi/core"),f=require("@pixi/text"),S=Object.defineProperty,T=Object.defineProperties,b=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,x=(t,e,i)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,L=(t,e)=>{for(var i in e||(e={}))v.call(e,i)&&x(t,i,e[i]);if(_)for(var i of _(e))M.call(e,i)&&x(t,i,e[i]);return t},O=(t,e)=>T(t,b(e));const d=class extends f.TextStyle{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new d(Object.keys(d.defaultOptions).reduce((e,i)=>O(L({},e),{[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete d.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=d;if(i[t]){const s=i[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return h.settings.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((o,r)=>{const l=URL.createObjectURL(s),n=new FileReader;n.onload=()=>o([l,n.result]),n.onerror=r,n.readAsDataURL(s)})).then(async([s,o])=>{const r=Object.assign({family:h.utils.path.basename(t,h.utils.path.extname(t)),weight:"normal",style:"normal",src:s,dataSrc:o,refs:1,originalUrl:t,fontFace:null},e);i[t]=r,this._fonts.push(r),this.styleID++;const l=new FontFace(r.family,`url(${r.src})`,{weight:r.weight,style:r.style});r.fontFace=l,await l.load(),document.fonts.add(l),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return["display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize*t}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing*t}px`,`text-align: ${this.align}`,`padding: ${this.padding*t}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight*t}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth*t}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness*t}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness*t}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS(t)]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=h.utils.rgb2hex(t)),typeof t=="number"?h.utils.hex2string(t):t}dropShadowToCSS(t){let e=this.normalizeColor(this.dropShadowColor);const i=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),o=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&i<1&&(e+=(i*255|0).toString(16).padStart(2,"0"));const r=`${s*t}px ${o*t}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,d.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=h.settings.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let u=d;u.availableFonts={},u.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const c=class extends w.Sprite{constructor(t="",e={}){var i;const s=new Image,o=h.Texture.from(s,{scaleMode:h.settings.SCALE_MODE,resourceOptions:{autoLoad:!1}});o.orig=new h.Rectangle,o.trim=new h.Rectangle,super(o),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const r="http://www.w3.org/2000/svg",l="http://www.w3.org/1999/xhtml",n=document.createElement("div"),a=document.createElementNS(r,"svg"),p=document.createElementNS(r,"foreignObject"),y=document.createElementNS(l,"div"),m=document.createElementNS(l,"style");p.setAttribute("width","10000"),p.setAttribute("height","10000"),p.style.overflow="hidden",a.appendChild(p),this.maxWidth=c.defaultMaxWidth,this.maxHeight=c.defaultMaxHeight,this._shadow=n,this._domElement=y,this._styleElement=m,this._svgRoot=a,this._foreignObject=p,this._foreignObject.appendChild(m),this._foreignObject.appendChild(y),this._image=s,this._autoResolution=c.defaultAutoResolution,this._shadowRoot=n.attachShadow({mode:"open"}),this._shadowRoot.appendChild(a),n.setAttribute("data-pixi-html-text","1"),Object.assign(n.style,{position:"absolute",top:"0",left:"-1px",width:"1px",height:"1px"}),document.body.appendChild(n),this._resolution=(i=c.defaultResolution)!=null?i:h.settings.RESOLUTION,this.text=t,this.style=e}measureText(t){var e,i;const{text:s,style:o,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:s,style:o.toCSS(r)}),this._styleElement.textContent=o.toGlobalCSS();const l=this._domElement.getBoundingClientRect(),n=Math.min(this.maxWidth,Math.ceil(l.width)),a=Math.min(this.maxHeight,Math.ceil(l.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",a.toString()),s!==this._text&&(this._domElement.innerHTML=this._text),o!==this._style&&(Object.assign(this._domElement,{style:(e=this._style)==null?void 0:e.toCSS(r)}),this._styleElement.textContent=(i=this._style)==null?void 0:i.toGlobalCSS()),{width:n+o.padding*2,height:a+o.padding*2}}async updateText(t=!0){const{style:e,_image:i}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:o}=this.measureText();i.width=Math.ceil(Math.max(1,s)),i.height=Math.ceil(Math.max(1,o)),this._loading||(this._loading=!0,await new Promise(r=>{i.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,this.updateTexture(),r()};const l=new XMLSerializer().serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`}))}get source(){return this._image}get canvas(){return h.utils.deprecation("3.2.0",'HTMLText property "canvas" is deprecated, use "source" instead.'),this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:s}=this,{padding:o}=t,{baseTexture:r}=e;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-o,e.trim.y=-o,e.orig.width=e._frame.width-o*2,e.orig.height=e._frame.height-o*2,this._onTextureUpdate(),r.setRealSize(i.width,i.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var e,i,s,o,r,l;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},c.defaultDestroyOptions,t),super.destroy(t);const n=null;this.ownsStyle&&((e=this._style)==null||e.cleanFonts()),this._style=n,(i=this._svgRoot)==null||i.remove(),this._svgRoot=n,(s=this._domElement)==null||s.remove(),this._domElement=n,(o=this._foreignObject)==null||o.remove(),this._foreignObject=n,(r=this._styleElement)==null||r.remove(),this._styleElement=n,(l=this._shadow)==null||l.remove(),this._shadow=n,this._shadowRoot=n,this._image.onload=null,this._image.src="",this._image=n}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=h.utils.sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=h.utils.sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof u?(this.ownsStyle=!1,this._style=t):t instanceof f.TextStyle?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=u.from(t)):(this.ownsStyle=!0,this._style=new u(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let g=c;g.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},g.defaultMaxWidth=2024,g.defaultMaxHeight=2024,g.defaultAutoResolution=!0,exports.HTMLText=g,exports.HTMLTextStyle=u;
//# sourceMappingURL=html-text.cjs.js.map
